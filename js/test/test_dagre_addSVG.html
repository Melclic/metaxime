<!DOCTYPE html>
<meta charset="utf-8">
<head>
  <!-- 
  <script src="bower_components/d3/d3.js"></script>
  <script src="bower_components/lodash/lodash.js"></script>
  <script src="bower_components/graphlib/dist/graphlib.core.js"></script>
  <script src="bower_components/dagre/dist/dagre.core.js"></script>
  <script src="bower_components/dagre-d3/dist/dagre-d3.core.js"></script>
  -->
  <script src="pkgs/d3.v6.js"></script>
  <script src="pkgs/dagre-d3.js"></script>
  <script src="pkgs/smiles-drawer.js"></script>
</head>
<style id="css">
h1 {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serf;
  margin-top: 0.8em;
  margin-bottom: 0.2em;
}

text {
  font-weight: 300;
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serf;
  font-size: 14px;
}

.node rect {
  stroke: #333;
  fill: #fff;
  stroke-width: 1.5px;
}

.node polygon {
  stroke: #333;
  fill: #fff;
  stroke-width: 1.5px;
}

.edgePath path.path {
  stroke: #333;
  fill: none;
  stroke-width: 1.5px;
}

div#top-frame {
  height: 350px;
}

div#WBS-frame {
  float: left;
  width: 50%;
}

div#dependencies-frame {
  float: left;
  width: 50%;
}

div#schedule-frame {
  float: none;
}
</style>
<body>
  <!-- <svg class="test" width=1200 height=400><g/></svg></div> -->
  <script>	

	var svg = d3.select("body")
		.append("svg")
		  .attr("width", "100%")
		  .attr("height", "100%")
		  .attr('id', 'test_svg')
		.append("g");	

	//var svg = d3.select('svg'),
	inner = svg.select('g');


	// Create the input graph
	var g = new dagreD3.graphlib.Graph()
	  .setGraph({nodesep: 30,
				 ranksep: 150,
				 rankdir: "LR",
				 marginx: 20,
				 marginy: 20
	  })
	  .setDefaultEdgeLabel(function() { return {}; });

	// Here we're setting nodeclass, which is used by our custom drawNodes function
	// below.
	for (var i=0; i<15; i++) {
	  /*
	  var canvas = document.createElement('canvas');
	  canvas.id = 'node_canvas_'+i 
	  g.setNode(i, {labelType: 'svg', label: canvas});
	  */
	  var shape = document.createElementNS("http://www.w3.org/2000/svg", "circle");
	  shape.cx.baseVal.value = 25;
	  shape.cy.baseVal.value = 25;
	  shape.r.baseVal.value = 20;
	  shape.setAttribute("fill", "green");
	  g.setNode(i, {labelType: 'svg', label: shape});
	}
  


	g.nodes().forEach(function(v) {
	  var node = g.node(v);
	  // Round the corners of the nodes
	  node.rx = node.ry = 5;
	});

	// Set up edges, no special attributes.
	g.setEdge(3, 4);
	g.setEdge(2, 3);
	g.setEdge(1, 2);
	g.setEdge(6, 7);
	g.setEdge(5, 6);
	g.setEdge(9, 10);
	g.setEdge(8, 9);
	g.setEdge(11,12);
	g.setEdge(8, 11);
	g.setEdge(5, 8);
	g.setEdge(1, 5);
	g.setEdge(13,14);
	g.setEdge(1, 13);
	g.setEdge(0, 1);
	g.setEdge(2, 6);


	//try to add a foreign object to the nodes
	/*
	g.nodes().forEach(function(v) {
	  console.log(g.node(v))
	});
	*/

	// Create the renderer
	var render = new dagreD3.render();

	// Set up an SVG group so that we can translate the final graph.
	var svg = d3.select("svg"),
		svgGroup = svg.append("g");

	// Run the renderer. This is what draws the final graph.
	render(d3.select("svg g"), g);

	/*
	console.log(document.getElementsByTagName('rect'))
	for (r of document.getElementsByTagName('rect')) {
	  var canvas = document.createElement('canvas');
	  canvas.id = "smiles_canvas_"+r.__data__;
	  r.appendChild(canvas);
	}
	*/
	/*
	document.getElementsByClassName('rect').forEach(function(v) {
	  console.log(v);

	});
	*/

	// Center the graph
	svg.attr("height", g.graph().height + 40);


	/*
	for (var i=0; i<15; i++) {
	  canvas_static = document.getElementById('node_canvas_'+i)
	  console.log(canvas_static)
	  makestrc('[H]OC(=O)C([H])=C([H])C([H])=C([H])C(=O)O[H]', canvas_static, 400.0, 400.0)
	}
	*/



	//################ functions ########################

    function isElement(o){
      return (
    typeof HTMLElement === "object" ? o instanceof HTMLElement : //DOM2
    o && typeof o === "object" && o !== null && o.nodeType === 1 && typeof o.nodeName==="string"
    );
    }

	function makestrc(input, in_canvas, in_width, in_height) {
	  smilesdrawer = new SmilesDrawer.Drawer({ width: in_width, height: in_height });
	  SmilesDrawer.parse(input, function(tree) {
			// draw to the canvas
			smilesdrawer.draw(tree, in_canvas, "light", false);
			// alternatively, draw to svg:
			//svgdrawer.draw(tree, canvas, 'dark', false);
		  });
	}

	function makeSVGstrc(input, in_canvas, in_width, in_height) {
	  svgDrawer = new SmilesDrawer.SvgDrawer({ width: in_width, height: in_height });
	  SmilesDrawer.parse(input, function(tree) {
			// draw to the canvas
			//smilesdrawer.draw(tree, in_canvas, "light", false);
			// alternatively, draw to svg:
			SmilesDrawer.draw(tree, in_canvas, 'dark', false);
		  });
	}

  </script>
</body>

