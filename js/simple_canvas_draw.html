<!DOCTYPE html>
<meta charset="utf-8">
<head>
  <script src="pkgs/d3.v6.js"></script>
  <script src="pkgs/smiles-drawer.js"></script>
  <script src="pkgs/canvas2svg.js"></script>
</head>
<body>
  <canvas id="example-canvas" width="100" height="100"></canvas>
  <script>
	/*
	var cas = d3.select("body")
	  .append("foreignObject")
		.attr('width', cmp_width)
		.attr('height', cmp_height)
		.attr('id', 'test')
		.append('xhtml:canvas')
		  //.attr('xmlns', 'http://www.w3.org/1999/xhtml');

	var elements = document.getElementsByTagName('foreignObject');
	for (var i=0; i<elements.length; i++) {
	  console.log(elements[i].id)
	  makeStrc('[H]OC(=O)C([H])=C([H])C([H])=C([H])C(=O)O[H]', document.querySelector('#'+elements[i].id+' canvas'), 100, 100);
	}
	*/

	//cas.attr("width", width).attr("height", height)

	//Traditional way of doing it
	var c = document.getElementById('example-canvas');
	console.log(c)
	console.log(isElement(c))
	makeStrc('[H]OC(=O)C([H])=C([H])C([H])=C([H])C(=O)O[H]', c, 100, 100);
	console.log(c)

	//create a new canvas
	//WARNING: need to add the canvas to the body before drawing... not sure why
	var canvas = document.createElement('canvas');
	var body = document.getElementsByTagName("body")[0];
	body.appendChild(canvas);
	console.log(canvas)
	makeStrc('[H]OP(=O)(O[H])OP(=O)(O[H])O[H]', canvas, 200, 200);
	console.log(isElement(canvas))
	console.log(canvas)


	//Use the canvas to svg to convert
	//WARNING: using this function will not work since we need to add the canvas to the dody before rendering
	var ctx = new C2S(500,500);
	console.log(ctx)
	console.log(isElement(ctx.__canvas))
	makeStrc('[H]OP(=O)(O[H])OP(=O)(O[H])OC([H])([H])C([H])([H])C(=C([H])[H])C([H])([H])[H]', ctx.__canvas, 500, 500);
	console.log(ctx)
	var myChem = ctx.getSerializedSvg(true);
	console.log(myChem)
	var cas = d3.select("body").append('div').html(myChem)



	//################ function ###################

    //Returns true if it is a DOM element
    function isElement(o){
      return (
    typeof HTMLElement === "object" ? o instanceof HTMLElement : //DOM2
    o && typeof o === "object" && o !== null && o.nodeType === 1 && typeof o.nodeName==="string"
    );
    }


	function makeStrc(input, canvas, width, height) {
    smilesDrawer = new SmilesDrawer.Drawer({ width: width, height: height });
    SmilesDrawer.parse(input, function(tree) {
          // Draw to the canvas
          smilesDrawer.draw(tree, canvas, "light", false);
          // Alternatively, draw to SVG:
          //svgDrawer.draw(tree, canvas, 'dark', false);
	});
  }
  </script>
</body>
