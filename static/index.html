<!DOCTYPE html>
<html>
<head>
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
  <meta content="utf-8" http-equiv="encoding">
  <title>MetaXime</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Bootstrap -->
  <link href="css/bootstrap/bootstrap.min.css" rel="stylesheet">
  <!-- styles -->
  <link href="css/styles.css" rel="stylesheet">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) 
  <script src="https://code.jquery.com/jquery.js"></script> -->
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="js/jquery-3.5.1.min.js"></script>
  <script src="js/bootstrap/bootstrap.min.js"></script>
  <script src="js/custom.js"></script>
  <script src="js/handle_strc.js"></script>
  <script src="js/smiles-drawer_mod.js"></script>
</head>
<body>
  <div class="header">
    <div class="container">
      <div class="row">
	<div class="col-md-5">
	  <!-- Logo -->
	  <div class="logo">
	    <h1><a href="index.html">MetaXime</a></h1>
	  </div>
	</div>
	<div class="col-md-2">
	  <div class="navbar navbar-inverse" role="banner">
	    <nav class="collapse navbar-collapse bs-navbar-collapse navbar-right" role="navigation">
	      <ul class="nav navbar-nav">
		<li class="dropdown">
		  <a href="#" class="dropdown-toggle" data-toggle="dropdown">My Account <b class="caret"></b></a>
		  <ul class="dropdown-menu animated fadeInUp">
		    <li><a href="profile.html">Profile</a></li>
		    <li><a href="login.html">Logout</a></li>
		  </ul>
		</li>
	      </ul>
	    </nav>
	  </div>
	</div>
      </div> <!-- container -->
    </div> <!-- container -->
  </div> <!-- header -->
  <div class="page-content">
    <div class="row" id="mai_row">
      <div class="col-md-2">
	<div class="sidebar content-box" style="display: block;">
	  <ul class="nav">
	    <!-- Main menu -->
	    <li class="current"><a href="index.html"><i class="glyphicon glyphicon-home"></i> Dashboard</a></li>
	    <li><a href="runjob.html"><i class="glyphicon glyphicon-calendar"></i> Run</a></li>
	  </ul>
	</div>
      </div>
      <div class="col-md-10">
	<div class="row">
	  <div class="col-md-6">
	    <div class="row" id="to_add_boxes">
	      <!-- Here we loop through the different job results
	      <div class="col-md-12">
		<div class="content-box-header">
		  <div class="panel-title">New vs Returning Visitors</div>
		  
		  <div class="panel-options">
		    <a href="#" data-rel="collapse"><i class="glyphicon glyphicon-refresh"></i></a>
		    <a href="#" data-rel="reload"><i class="glyphicon glyphicon-cog"></i></a>
		  </div>
		</div>
		<div class="content-box-large box-with-header">
		  
		  2  == Pellentesque luctus quam quis consequat vulputate. Sed sit amet diam ipsum. Praesent in pellentesque diam, sit amet dignissim erat. Aliquam erat volutpat. Aenean laoreet metus leo, laoreet feugiat enim suscipit quis. Praesent mauris mauris, ornare vitae tincidunt sed, hendrerit eget augue. Nam nec vestibulum nisi, eu dignissim nulla.
		  <br /><br />
		</div>
	      </div>
	      -->
	    </div>
	  </div>
	</div>
      </div>
    </div>
  </div>

  <script>
    function makeDashBoard() {
      $.ajax({
	url: 'http://'+location.host+':8888/REST/GetJobList',
	type: 'POST',
	data: JSON.stringify({}),
	processData: false,
	contentType: 'application/json',
	dataType: 'json',
	success: function(response) {
	  console.log(response);
	  $.each(response, function(i, val) {
	    console.log(i);
	    console.log(val);
	    //clear the page
	    //prepare the data
	    var rightList = [val["input"]["gem"], val["input"]["steps"], val["job"]["status"], val["job"]["meta"]["progress"]*100.0/12.0.toString()+'%', val["job"]["meta"]["err_msg"]]
	    var leftList = ["Organism", "Max Steps", "Job Status", "Job Progress", "Error Message"];
	    //box header
	    let div_box_header = document.createElement('div');
	    div_box_header.className = "content-box-header";
	      //box header title
	      div_box_header.innerHTML = '<div class="panel-options"><a href="#" data-rel="reload"><i class="glyphicon glyphicon-cog"></i></a></div>';
	      let div_box_header_title = document.createElement('div');
	      div_box_header_title.className = "panel-title";
	      div_box_header_title.innerHTML = 'Target Molecule: '+val['input']['name'];
	      div_box_header.append(div_box_header_title);
	    //box content
	    let div_box_content = document.createElement('div');
	    div_box_content.className = "content-box-large box-with-header";
	      //seperate the box content into text and canvas
	      var div_box_desc = document.createElement('div');
	      div_box_desc.className = "row";
		//table ie. two lists side by side
		var div_box_desc_1 = document.createElement('div');
		div_box_desc_1.className = "col-sm no-gutters";
		  var info_list = document.createElement('ul');
		  for (var i = 0; i < leftList.length; i++) {
		    var tmp_li = document.createElement('li');
		    tmp_li.className = "list-group-item";
		    tmp_li.innerHTML = "<b>"+leftList[i]+"</b>: "+rightList[i];
		    info_list.append(tmp_li);
		  }
		div_box_desc_1.append(info_list);
	      div_box_desc.append(div_box_desc_1);
		var div_box_desc_2 = document.createElement('div');
		div_box_desc_2.className = "col-sm no-gutters";
		  var canvas = document.createElement('canvas');
		  canvas.setAttribute('width', 200);
		  canvas.setAttribute('height', 200);
		  canvas.id = val['input']['name']+'_strc';
		  //canvas.onclick=;
		div_box_desc_2.append(canvas);
	      div_box_desc.append(div_box_desc_2);
	    div_box_content.append(div_box_desc);
	    //div_box_content.append(document.createElement('br'));
	    //highest level
	    div = document.createElement('div');
	    div.className = "col-md-12";
	    div.append(div_box_header);
	    div.append(div_box_content);
	    parent_div = document.getElementById('to_add_boxes');
	    parent_div.append(div);
	    makeStrc(val['input']['smiles'], val['input']['name']+'_strc', 200, 200);
	  });
	},
	headers: {
	    'Access-Control-Allow-Origin': '*'
	}
      });
    }
    makeDashBoard();
    //every 60s reload to see if the jobs have been updated
    //TODO: only if on or more are queued or running
    setInterval(function() {
      parent_div = document.getElementById('to_add_boxes');
      parent_div.innerHTML = '';
      makeDashBoard();
    }, 60000);
  </script>
  <footer>
    <div class="container">
      <div class="copy text-center">
	Created by: <a href='http://github.com/melclic/'>Melchior du Lac</a>
      </div>
    </div>
  </footer>
</body>
</html>
